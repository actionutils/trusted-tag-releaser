name: Release Check (Deprecated)

# DEPRECATED: This reusable workflow is no longer used.
# Release check logic has been consolidated into
# .github/workflows/trusted-release-workflow.yml.
# This file is kept for backward compatibility and only emits a
# deprecation notice. It always outputs skip=true.
#
# If you are calling this workflow, please migrate to
# .github/workflows/trusted-release-workflow.yml.
#
# This workflow used to check if a tag release is needed based on PR labels
# and was designed as a reusable workflow that can be called from other workflows.
on:
  workflow_call:
    inputs:
      branch:
        description: 'The working branch'
        required: false
        default: ${{ github.event.repository.default_branch }}
        type: string
    outputs:
      skip:
        description: 'Whether to skip the release'
        value: ${{ jobs.check-version.outputs.skip }}
      next_version:
        description: 'The next version to release'
        value: ${{ jobs.check-version.outputs.next_version }}
      current_version:
        description: 'The current version'
        value: ${{ jobs.check-version.outputs.current_version }}
      message:
        description: 'Tag message'
        value: ${{ jobs.check-version.outputs.message }}

permissions:
  contents: read

jobs:
  # Check if a version bump is needed
  check-version:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    outputs:
      skip: ${{ steps.deprecated.outputs.skip }}
      next_version: ${{ steps.deprecated.outputs.next_version }}
      current_version: ${{ steps.deprecated.outputs.current_version }}
      message: ${{ steps.deprecated.outputs.message }}
    steps:
      - name: Harden the runner (Audit all outbound calls)
        uses: step-security/harden-runner@f4a75cfd619ee5ce8d5b864b0d183aff3c69b55a # v2.13.1
        with:
          egress-policy: audit

      - id: deprecated
        name: Emit deprecation notice
        run: |
          echo "::warning::'release-check.yml' is deprecated. Use '.github/workflows/trusted-release-workflow.yml' instead."

          {
            echo "# Release Check (Deprecated)"
            echo "This workflow is deprecated and kept only for backward compatibility."
            echo "Please migrate to '.github/workflows/trusted-release-workflow.yml'."
          } >> "$GITHUB_STEP_SUMMARY"

          # Expose outputs to keep interface compatible
          echo "skip=true" >> "$GITHUB_OUTPUT"
          echo "next_version=" >> "$GITHUB_OUTPUT"
          echo "current_version=" >> "$GITHUB_OUTPUT"
          echo "message=release-check.yml is deprecated; use trusted-release-workflow.yml" >> "$GITHUB_OUTPUT"
